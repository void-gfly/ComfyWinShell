<UserControl x:Class="WpfDesktop.Views.ConfigurationView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d"
             d:DesignHeight="1800" d:DesignWidth="1000">

    <UserControl.Resources>
        <!-- Card Style -->
        <Style x:Key="CardBorder" TargetType="Border">
            <Setter Property="Background" Value="#141414"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="20"/>
            <Setter Property="Margin" Value="0"/>
        </Style>

        <Style x:Key="SectionExpander" TargetType="Expander">
            <Setter Property="IsExpanded" Value="False"/>
            <Setter Property="Margin" Value="0,0,0,16"/>
            <Setter Property="HeaderTemplate">
                <Setter.Value>
                    <DataTemplate>
                        <TextBlock Text="{Binding}"
                                   Foreground="#D4AF37"
                                   FontSize="16"
                                   FontWeight="Bold"
                                   Margin="0,0,0,8"/>
                    </DataTemplate>
                </Setter.Value>
            </Setter>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type Expander}">
                        <DockPanel>
                            <ToggleButton x:Name="HeaderSite"
                                          DockPanel.Dock="Top"
                                          Content="{TemplateBinding Header}"
                                          ContentTemplate="{TemplateBinding HeaderTemplate}"
                                          IsChecked="{Binding IsExpanded, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                          Padding="{TemplateBinding Padding}">
                                <ToggleButton.Template>
                                    <ControlTemplate TargetType="ToggleButton">
                                        <Border Background="Transparent" Padding="{TemplateBinding Padding}">
                                            <Grid Background="Transparent" SnapsToDevicePixels="False">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                <!-- Custom Gold Toggle Arrow -->
                                                <Border x:Name="Circle"
                                                        Width="24"
                                                        Height="24"
                                                        CornerRadius="12"
                                                        BorderBrush="#D4AF37"
                                                        BorderThickness="1"
                                                        Background="Transparent"
                                                        HorizontalAlignment="Center"
                                                        VerticalAlignment="Center"
                                                        Margin="0,0,10,0">
                                                    <Path x:Name="Arrow"
                                                          Data="M 0,0 L 4,4 L 8,0"
                                                          Stroke="#D4AF37"
                                                          StrokeThickness="2"
                                                          HorizontalAlignment="Center"
                                                          VerticalAlignment="Center"
                                                          RenderTransformOrigin="0.5,0.5">
                                                        <Path.RenderTransform>
                                                            <RotateTransform Angle="-90"/>
                                                        </Path.RenderTransform>
                                                    </Path>
                                                </Border>
                                                
                                                <ContentPresenter Grid.Column="1"
                                                                  VerticalAlignment="Center"
                                                                  RecognizesAccessKey="True"/>
                                            </Grid>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsChecked" Value="True">
                                                <Setter TargetName="Arrow" Property="RenderTransform">
                                                    <Setter.Value>
                                                        <RotateTransform Angle="0"/>
                                                    </Setter.Value>
                                                </Setter>
                                                <Setter TargetName="Circle" Property="Background" Value="#20D4AF37"/>
                                            </Trigger>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="Circle" Property="BorderBrush" Value="#FFD700"/>
                                                <Setter TargetName="Arrow" Property="Stroke" Value="#FFD700"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </ToggleButton.Template>
                            </ToggleButton>
                            <ContentPresenter x:Name="ExpandSite"
                                              DockPanel.Dock="Bottom"
                                              Focusable="false"
                                              HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                              Margin="{TemplateBinding Padding}"
                                              VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                              Visibility="Collapsed"/>
                        </DockPanel>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsExpanded" Value="True">
                                <Setter TargetName="ExpandSite" Property="Visibility" Value="Visible"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="FieldLabel" TargetType="TextBlock">
            <Setter Property="Foreground" Value="{DynamicResource TextBrush}"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Opacity" Value="0.6"/>
            <Setter Property="Margin" Value="0,0,0,4"/>
        </Style>

        <Style TargetType="CheckBox">
            <Setter Property="Foreground" Value="{DynamicResource TextBrush}"/>
        </Style>
    </UserControl.Resources>

<Grid Background="#050505">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Fixed Top Header -->
        <Border Grid.Row="0" Margin="0" Padding="24,20,24,15" BorderBrush="#2A2A2A" BorderThickness="0,0,0,1" Background="#050505" Panel.ZIndex="100">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" Text="ComfyUI é…ç½®" FontSize="28" FontWeight="Light" Foreground="{DynamicResource TextBrush}" VerticalAlignment="Center"/>
                
                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                    <Button Command="{Binding LoadDefaultCommand}" Content="åŠ è½½é…ç½®" Style="{DynamicResource SecondaryButtonStyle}" Margin="0,0,10,0"/>
                    <Button Command="{Binding SaveDefaultCommand}" Content="ä¿å­˜é…ç½®" Style="{DynamicResource PrimaryButtonStyle}"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Scrollable Content -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Background="#050505">
            <StackPanel Margin="24" MaxWidth="1200" HorizontalAlignment="Stretch">
                
                <!-- Network -->
                <Expander Header="ç½‘ç»œè®¾ç½® (Network)" Style="{StaticResource SectionExpander}">
                    <Border Style="{StaticResource CardBorder}">
                        <StackPanel>
                            <WrapPanel Orientation="Horizontal">
                                <StackPanel Margin="0,0,20,10" ToolTip="æŒ‡å®šç›‘å¬çš„ IP åœ°å€ã€‚é»˜è®¤ä¸º 127.0.0.1 (ä»…æœ¬æœº)ã€‚å¦‚æžœè®¾ç½®ä¸º 0.0.0.0 åˆ™ç›‘å¬æ‰€æœ‰ç½‘ç»œæŽ¥å£ã€‚(--listen)">
                                    <TextBlock Text="ç›‘å¬åœ°å€ (Listen)" Style="{StaticResource FieldLabel}"/>
                                    <TextBox Text="{Binding Configuration.Network.Listen, UpdateSourceTrigger=PropertyChanged}" Width="200"/>
                                </StackPanel>
                                <StackPanel Margin="0,0,20,10" ToolTip="è®¾ç½®ç›‘å¬ç«¯å£ã€‚é»˜è®¤ä¸º 8188ã€‚(--port)">
                                    <TextBlock Text="ç«¯å£ (Port)" Style="{StaticResource FieldLabel}"/>
                                    <TextBox Text="{Binding Configuration.Network.Port, UpdateSourceTrigger=PropertyChanged}" Width="120"/>
                                </StackPanel>
                                <StackPanel Margin="0,0,20,10" ToolTip="æ·»åŠ  Access-Control-Allow-Origin å¤´åˆ°å“åº”ä¸­ã€‚ç”¨äºŽè·¨åŸŸè¯·æ±‚ã€‚(--cors-header)">
                                    <TextBlock Text="CORS æ¥æº" Style="{StaticResource FieldLabel}"/>
                                    <TextBox Text="{Binding Configuration.Network.CorsOrigin, UpdateSourceTrigger=PropertyChanged}" Width="200"/>
                                </StackPanel>
                                <StackPanel Margin="0,0,0,10" ToolTip="è®¾ç½®æœ€å¤§ä¸Šä¼ æ–‡ä»¶å¤§å°(MB)ã€‚é»˜è®¤ä¸º 100MBã€‚(--max-upload-size)">
                                    <TextBlock Text="æœ€å¤§ä¸Šä¼  (MB)" Style="{StaticResource FieldLabel}"/>
                                    <TextBox Text="{Binding Configuration.Network.MaxUploadSizeMb, UpdateSourceTrigger=PropertyChanged}" Width="120"/>
                                </StackPanel>
                            </WrapPanel>
                            <Grid Margin="0,10,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0" Margin="0,0,10,0" ToolTip="TLS å¯†é’¥æ–‡ä»¶è·¯å¾„ã€‚ç”¨äºŽå¯ç”¨ HTTPSã€‚(--tls-keyfile)">
                                    <TextBlock Text="TLS å¯†é’¥ (Key)" Style="{StaticResource FieldLabel}"/>
                                    <TextBox Text="{Binding Configuration.Network.TlsKeyFile, UpdateSourceTrigger=PropertyChanged}"/>
                                </StackPanel>
                                <StackPanel Grid.Column="1" ToolTip="TLS è¯ä¹¦æ–‡ä»¶è·¯å¾„ã€‚ç”¨äºŽå¯ç”¨ HTTPSã€‚(--tls-certfile)">
                                    <TextBlock Text="TLS è¯ä¹¦ (Cert)" Style="{StaticResource FieldLabel}"/>
                                    <TextBox Text="{Binding Configuration.Network.TlsCertFile, UpdateSourceTrigger=PropertyChanged}"/>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </Border>
                </Expander>

                <!-- Paths -->
                <Expander Header="è·¯å¾„è®¾ç½® (Paths)" Style="{StaticResource SectionExpander}">
                    <Border Style="{StaticResource CardBorder}">
                        <StackPanel>
                            <StackPanel Margin="0,0,0,10" ToolTip="ComfyUI çš„åŸºç¡€å®‰è£…ç›®å½•ã€‚">
                                <TextBlock Text="åŸºç¡€ç›®å½• (Base)" Style="{StaticResource FieldLabel}"/>
                                <DockPanel>
                                    <Button DockPanel.Dock="Right" Content="æµè§ˆ" Command="{Binding BrowseDirectoryCommand}" CommandParameter="Base" Style="{DynamicResource SecondaryButtonStyle}" Margin="10,0,0,0"/>
                                    <TextBox Text="{Binding Configuration.Paths.BaseDirectory, UpdateSourceTrigger=PropertyChanged}"/>
                                </DockPanel>
                            </StackPanel>

                            <StackPanel Margin="0,0,0,10" ToolTip="æ‰©å±•æ¨¡åž‹åŸºç¡€ç›®å½•ã€‚æŒ‡å®šåŽä¼šè‡ªåŠ¨ç”Ÿæˆ extra_model_paths.yamlï¼Œä½¿ç”¨æ ‡å‡†çš„ models/ å­ç›®å½•ç»“æž„ï¼ˆcheckpointsã€lorasã€vae ç­‰ï¼‰ã€‚é€‚ç”¨äºŽä¸Žå…¶ä»– ComfyUI å®žä¾‹æˆ– WebUI å…±äº«æ¨¡åž‹ã€‚">
                                <TextBlock Text="æ‰©å±•æ¨¡åž‹ç›®å½• (Extra Models Base)" Style="{StaticResource FieldLabel}"/>
                                <DockPanel>
                                    <Button DockPanel.Dock="Right" Content="æµè§ˆ" Command="{Binding BrowseDirectoryCommand}" CommandParameter="ExtraModelBase" Style="{DynamicResource SecondaryButtonStyle}" Margin="10,0,0,0"/>
                                    <TextBox Text="{Binding Configuration.Paths.ExtraModelBaseDirectory, UpdateSourceTrigger=PropertyChanged}"/>
                                </DockPanel>
                                <TextBlock Text="ðŸ’¡ è¯¥ç›®å½•ä¸‹åº”åŒ…å« models/checkpointsã€models/loras ç­‰æ ‡å‡†å­ç›®å½•" 
                                           Foreground="#888888" 
                                           FontSize="11" 
                                           Margin="0,4,0,0"/>
                            </StackPanel>

                            <StackPanel Margin="0,0,0,10" ToolTip="è®¾ç½®è¾“å‡ºç›®å½•ï¼Œç”¨äºŽä¿å­˜ç”Ÿæˆçš„å›¾åƒã€‚(--output-directory)">
                                <TextBlock Text="è¾“å‡ºç›®å½• (Output)" Style="{StaticResource FieldLabel}"/>
                                <DockPanel>
                                    <Button DockPanel.Dock="Right" Content="æµè§ˆ" Command="{Binding BrowseDirectoryCommand}" CommandParameter="Output" Style="{DynamicResource SecondaryButtonStyle}" Margin="10,0,0,0"/>
                                    <TextBox Text="{Binding Configuration.Paths.OutputDirectory, UpdateSourceTrigger=PropertyChanged}"/>
                                </DockPanel>
                            </StackPanel>

                            <StackPanel Margin="0,0,0,10" ToolTip="è®¾ç½®è¾“å…¥ç›®å½•ï¼Œç”¨äºŽå­˜æ”¾è¾“å…¥å›¾åƒã€‚(--input-directory)">
                                <TextBlock Text="è¾“å…¥ç›®å½• (Input)" Style="{StaticResource FieldLabel}"/>
                                <DockPanel>
                                    <Button DockPanel.Dock="Right" Content="æµè§ˆ" Command="{Binding BrowseDirectoryCommand}" CommandParameter="Input" Style="{DynamicResource SecondaryButtonStyle}" Margin="10,0,0,0"/>
                                    <TextBox Text="{Binding Configuration.Paths.InputDirectory, UpdateSourceTrigger=PropertyChanged}"/>
                                </DockPanel>
                            </StackPanel>

                            <StackPanel Margin="0,0,0,10" ToolTip="è®¾ç½®ä¸´æ—¶ç›®å½•ï¼Œç”¨äºŽå­˜æ”¾ä¸­é—´æ–‡ä»¶ã€‚(--temp-directory)">
                                <TextBlock Text="ä¸´æ—¶ç›®å½• (Temp)" Style="{StaticResource FieldLabel}"/>
                                <DockPanel>
                                    <Button DockPanel.Dock="Right" Content="æµè§ˆ" Command="{Binding BrowseDirectoryCommand}" CommandParameter="Temp" Style="{DynamicResource SecondaryButtonStyle}" Margin="10,0,0,0"/>
                                    <TextBox Text="{Binding Configuration.Paths.TempDirectory, UpdateSourceTrigger=PropertyChanged}"/>
                                </DockPanel>
                            </StackPanel>

                            <StackPanel Margin="0,0,0,10" ToolTip="è®¾ç½®ç”¨æˆ·ç›®å½•ï¼Œç”¨äºŽå­˜æ”¾ç”¨æˆ·æ•°æ®ï¼ˆå¦‚å·¥ä½œæµã€æ ·å¼ï¼‰ã€‚(--user-directory)">
                                <TextBlock Text="ç”¨æˆ·ç›®å½• (User)" Style="{StaticResource FieldLabel}"/>
                                <DockPanel>
                                    <Button DockPanel.Dock="Right" Content="æµè§ˆ" Command="{Binding BrowseDirectoryCommand}" CommandParameter="User" Style="{DynamicResource SecondaryButtonStyle}" Margin="10,0,0,0"/>
                                    <TextBox Text="{Binding Configuration.Paths.UserDirectory, UpdateSourceTrigger=PropertyChanged}"/>
                                </DockPanel>
                            </StackPanel>

                            <StackPanel ToolTip="åŠ è½½é¢å¤–çš„æ¨¡åž‹è·¯å¾„é…ç½®æ–‡ä»¶ (extra_model_paths.yaml)ã€‚æ¯è¡Œä¸€ä¸ªè·¯å¾„ã€‚(--extra-model-paths-config)">
                                <TextBlock Text="é¢å¤–é…ç½®æ–‡ä»¶è·¯å¾„ (Advanced)" Style="{StaticResource FieldLabel}"/>
                                <TextBox Text="{Binding ExtraModelPathsText, UpdateSourceTrigger=PropertyChanged}"
                                         AcceptsReturn="True" Height="80" TextWrapping="Wrap" VerticalScrollBarVisibility="Auto"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                </Expander>

                <!-- Device -->
                <Expander Header="è®¾å¤‡é…ç½® (Device)" Style="{StaticResource SectionExpander}">
                    <Border Style="{StaticResource CardBorder}">
                        <StackPanel>
                            <WrapPanel>
                                <StackPanel Margin="0,0,20,10" ToolTip="è®¾ç½®ä½¿ç”¨çš„ CUDA è®¾å¤‡ IDã€‚(--cuda-device)">
                                    <TextBlock Text="CUDA è®¾å¤‡" Style="{StaticResource FieldLabel}"/>
                                    <ComboBox ItemsSource="{Binding CudaDevices}"
                                              SelectedItem="{Binding SelectedCudaDevice}"
                                              DisplayMemberPath="DisplayName"
                                              Width="280"/>
                                </StackPanel>
                                <StackPanel Margin="0,0,20,10" ToolTip="é…ç½®ä½¿ç”¨çš„é»˜è®¤è®¾å¤‡ IDã€‚æ­¤è®¾ç½®å¯èƒ½å½±å“éž CUDA è®¾å¤‡ã€‚">
                                    <TextBlock Text="é»˜è®¤è®¾å¤‡ ID" Style="{StaticResource FieldLabel}"/>
                                    <TextBox Text="{Binding Configuration.Device.DefaultDevice, UpdateSourceTrigger=PropertyChanged, TargetNullValue=''}" Width="120"/>
                                </StackPanel>
                                <StackPanel Margin="0,0,20,10" ToolTip="æŒ‡å®š DirectML è®¾å¤‡ IDã€‚ç”¨äºŽ AMD/Intel æ˜¾å¡ã€‚(--directml)">
                                    <TextBlock Text="DirectML è®¾å¤‡" Style="{StaticResource FieldLabel}"/>
                                    <TextBox Text="{Binding Configuration.Device.DirectMlDevice, UpdateSourceTrigger=PropertyChanged, TargetNullValue=''}" Width="120"/>
                                </StackPanel>
                                <StackPanel Margin="0,0,0,10" ToolTip="OneAPI è®¾å¤‡é€‰æ‹©å­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ 'level_zero:0'ã€‚">
                                    <TextBlock Text="OneAPI é€‰æ‹©å™¨" Style="{StaticResource FieldLabel}"/>
                                    <TextBox Text="{Binding Configuration.Device.OneApiDeviceSelector, UpdateSourceTrigger=PropertyChanged}" Width="200"/>
                                </StackPanel>
                            </WrapPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                                <CheckBox Content="ç¦ç”¨ IPEX ä¼˜åŒ–" IsChecked="{Binding Configuration.Device.DisableIpexOptimize}" Margin="0,0,20,0" ToolTip="ç¦ç”¨ Intel PyTorch Extension (IPEX) ä¼˜åŒ–ã€‚ç”¨äºŽ Intel GPUã€‚"/>
                                <CheckBox Content="CPU VAE" IsChecked="{Binding Configuration.Device.CpuVae}" ToolTip="åœ¨ CPU ä¸Šè¿è¡Œ VAE è§£ç /ç¼–ç ã€‚å¯ä»¥èŠ‚çœæ˜¾å­˜ï¼Œä½†é€Ÿåº¦è¾ƒæ…¢ã€‚(--cpu-vae)"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                </Expander>

                <!-- Memory -->
                <Expander Header="å†…å­˜æ˜¾å­˜ (Memory)" Style="{StaticResource SectionExpander}">
                    <Border Style="{StaticResource CardBorder}">
                        <StackPanel>
                            <WrapPanel>
                                <StackPanel Margin="0,0,20,10" ToolTip="è®¾ç½®æ˜¾å­˜ç®¡ç†æ¨¡å¼ï¼šhigh (å…¨éƒ¨åŠ è½½åˆ°æ˜¾å­˜), low (ä½Žæ˜¾å­˜æ¨¡å¼), normal (å¹³è¡¡æ¨¡å¼)ã€‚(--lowvram, --highvram, --normalvram)">
                                    <TextBlock Text="æ˜¾å­˜æ¨¡å¼ (VRAM)" Style="{StaticResource FieldLabel}"/>
                                    <ComboBox ItemsSource="{Binding VramModes}" SelectedItem="{Binding Configuration.Memory.VramMode}" Width="200"/>
                                </StackPanel>
                                <StackPanel Margin="0,0,20,10" ToolTip="å¼ºåˆ¶ä¿ç•™æŒ‡å®šçš„æ˜¾å­˜é‡(GB)ï¼Œä¸ç”¨äºŽ ComfyUIã€‚(--reserve-vram)">
                                    <TextBlock Text="ä¿ç•™æ˜¾å­˜ (GB)" Style="{StaticResource FieldLabel}"/>
                                    <TextBox Text="{Binding Configuration.Memory.ReserveVramGb, UpdateSourceTrigger=PropertyChanged, TargetNullValue=''}" Width="120"/>
                                </StackPanel>
                                <StackPanel Margin="0,0,0,10" ToolTip="è®¾ç½®å¼‚æ­¥å¸è½½æµçš„æ•°é‡ã€‚">
                                    <TextBlock Text="å¼‚æ­¥æµæ•°é‡" Style="{StaticResource FieldLabel}"/>
                                    <TextBox Text="{Binding Configuration.Memory.AsyncOffloadStreams, UpdateSourceTrigger=PropertyChanged, TargetNullValue=''}" Width="120"/>
                                </StackPanel>
                            </WrapPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                                <CheckBox Content="å¼‚æ­¥å¸è½½ (Async Offload)" IsChecked="{Binding Configuration.Memory.AsyncOffload}" Margin="0,0,20,0" ToolTip="å¯ç”¨æ¨¡åž‹å¼‚æ­¥å¸è½½åˆ°ç³»ç»Ÿå†…å­˜ã€‚"/>
                                <CheckBox Content="æ™ºèƒ½å†…å­˜ (Smart Memory)" IsChecked="{Binding Configuration.Memory.SmartMemory}" ToolTip="å¯ç”¨æ™ºèƒ½å†…å­˜ç®¡ç† (æ­¤é€‰é¡¹å¯èƒ½ä¼šè¢« ComfyUI é»˜è®¤å¯ç”¨)ã€‚(--disable-smart-memory to disable)"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                </Expander>

                <!-- Precision -->
                <Expander Header="ç²¾åº¦è®¾ç½® (Precision)" Style="{StaticResource SectionExpander}">
                    <Border Style="{StaticResource CardBorder}">
                        <StackPanel>
                            <WrapPanel>
                                <StackPanel Margin="0,0,20,10" ToolTip="å¼ºåˆ¶ä½¿ç”¨ç‰¹å®šçš„æµ®ç‚¹ç²¾åº¦è¿›è¡Œè®¡ç®—ã€‚(--force-fp16, --force-fp32)">
                                    <TextBlock Text="å¼ºåˆ¶ç²¾åº¦" Style="{StaticResource FieldLabel}"/>
                                    <ComboBox ItemsSource="{Binding ForcePrecisionModes}" SelectedItem="{Binding Configuration.Precision.ForcePrecision}" Width="180"/>
                                </StackPanel>
                                <StackPanel Margin="0,0,20,10" ToolTip="è®¾ç½® UNet æ¨¡åž‹çš„è®¡ç®—ç²¾åº¦ã€‚(--fp16-unet, --fp32-unet)">
                                    <TextBlock Text="UNet ç²¾åº¦" Style="{StaticResource FieldLabel}"/>
                                    <ComboBox ItemsSource="{Binding UnetPrecisionModes}" SelectedItem="{Binding Configuration.Precision.UnetPrecision}" Width="180"/>
                                </StackPanel>
                                <StackPanel Margin="0,0,20,10" ToolTip="è®¾ç½® VAE æ¨¡åž‹çš„è®¡ç®—ç²¾åº¦ã€‚(--fp16-vae, --fp32-vae, --bf16-vae)">
                                    <TextBlock Text="VAE ç²¾åº¦" Style="{StaticResource FieldLabel}"/>
                                    <ComboBox ItemsSource="{Binding VaePrecisionModes}" SelectedItem="{Binding Configuration.Precision.VaePrecision}" Width="180"/>
                                </StackPanel>
                                <StackPanel Margin="0,0,0,10" ToolTip="è®¾ç½® TextEncoder (CLIP) çš„è®¡ç®—ç²¾åº¦ã€‚(--fp16-te, --fp32-te)">
                                    <TextBlock Text="TextEncoder ç²¾åº¦" Style="{StaticResource FieldLabel}"/>
                                    <ComboBox ItemsSource="{Binding TextEncoderPrecisionModes}" SelectedItem="{Binding Configuration.Precision.TextEncoderPrecision}" Width="180"/>
                                </StackPanel>
                            </WrapPanel>
                        </StackPanel>
                    </Border>
                </Expander>

                <!-- Attention & Preview -->
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="16"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <Expander Grid.Column="0" Header="æ³¨æ„åŠ›æœºåˆ¶ (Attention)" Style="{StaticResource SectionExpander}">
                        <Border Style="{StaticResource CardBorder}">
                            <StackPanel>
                                <StackPanel Margin="0,0,0,10" ToolTip="é€‰æ‹© Cross-Attention çš„å®žçŽ°æ–¹å¼ã€‚Split (Apple), Quad (Nvidia Old), Pytorch (Newer)ã€‚(--use-split-cross-attention, etc)">
                                    <TextBlock Text="æ¨¡å¼" Style="{StaticResource FieldLabel}"/>
                                    <ComboBox ItemsSource="{Binding AttentionModes}" SelectedItem="{Binding Configuration.Attention.Mode}"/>
                                </StackPanel>
                                <StackPanel Margin="0,0,0,10" ToolTip="æŽ§åˆ¶æ˜¯å¦å¼ºåˆ¶å¼€å¯æˆ–ç¦ç”¨ Attention å‘ä¸Šè½¬æ¢ (Upcast)ã€‚(--force-upcast-attention, --dont-upcast-attention)">
                                    <TextBlock Text="Upcast" Style="{StaticResource FieldLabel}"/>
                                    <ComboBox ItemsSource="{Binding UpcastModes}" SelectedItem="{Binding Configuration.Attention.UpcastMode}"/>
                                </StackPanel>
                                <CheckBox Content="ä½¿ç”¨ xFormers" IsChecked="{Binding Configuration.Attention.UseXFormers}" ToolTip="å¯ç”¨ xFormers åº“è¿›è¡ŒåŠ é€Ÿã€‚å¦‚æžœå®‰è£…äº† xFormers é»˜è®¤å¯ç”¨ã€‚å–æ¶ˆå‹¾é€‰ä»¥ç¦ç”¨ã€‚(--disable-xformers)"/>
                            </StackPanel>
                        </Border>
                    </Expander>

                    <Expander Grid.Column="2" Header="é¢„è§ˆè®¾ç½® (Preview)" Style="{StaticResource SectionExpander}">
                        <Border Style="{StaticResource CardBorder}">
                            <StackPanel>
                                <StackPanel Margin="0,0,0,10" ToolTip="è®¾ç½®é‡‡æ ·è¿‡ç¨‹ä¸­çš„å›¾åƒé¢„è§ˆæ–¹å¼ã€‚Auto, None, Latents (å¿«é€Ÿ), TAESD (é«˜è´¨é‡)ã€‚(--preview-method)">
                                    <TextBlock Text="é¢„è§ˆæ–¹å¼" Style="{StaticResource FieldLabel}"/>
                                    <ComboBox ItemsSource="{Binding PreviewMethods}" SelectedItem="{Binding Configuration.Preview.Method}"/>
                                </StackPanel>
                                <StackPanel ToolTip="é™åˆ¶é¢„è§ˆå›¾åƒçš„å°ºå¯¸ã€‚é»˜è®¤ä¸º 512ã€‚">
                                    <TextBlock Text="é¢„è§ˆå°ºå¯¸" Style="{StaticResource FieldLabel}"/>
                                    <TextBox Text="{Binding Configuration.Preview.PreviewSize, UpdateSourceTrigger=PropertyChanged}" Width="120"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                    </Expander>
                </Grid>

                <!-- Cache & Manager -->
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="16"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <Expander Grid.Column="0" Header="ç¼“å­˜è®¾ç½® (Cache)" Style="{StaticResource SectionExpander}">
                        <Border Style="{StaticResource CardBorder}">
                            <StackPanel>
                                <StackPanel Margin="0,0,0,10" ToolTip="æš‚æ—¶åªæœ‰ LRU ç¼“å­˜æ¨¡å¼å¯é€‰ã€‚">
                                    <TextBlock Text="æ¨¡å¼" Style="{StaticResource FieldLabel}"/>
                                    <ComboBox ItemsSource="{Binding CacheModes}" SelectedItem="{Binding Configuration.Cache.Mode}"/>
                                </StackPanel>
                                <StackPanel Margin="0,0,0,10" ToolTip="è®¾ç½®ç¼“å­˜ä¸­ä¿ç•™çš„æ¨¡åž‹æ•°é‡ã€‚">
                                    <TextBlock Text="LRU æ•°é‡" Style="{StaticResource FieldLabel}"/>
                                    <TextBox Text="{Binding Configuration.Cache.LruCount, UpdateSourceTrigger=PropertyChanged}" Width="120"/>
                                </StackPanel>
                                <StackPanel ToolTip="è®¾ç½® RAM é˜ˆå€¼(GB)ã€‚ä¸çŸ¥é“å…·ä½“ç”¨é€”ï¼Œå¯èƒ½æ˜¯ç”¨äºŽæ¸…ç†ç¼“å­˜çš„é˜ˆå€¼ã€‚">
                                    <TextBlock Text="RAM é˜ˆå€¼ (GB)" Style="{StaticResource FieldLabel}"/>
                                    <TextBox Text="{Binding Configuration.Cache.RamThresholdGb, UpdateSourceTrigger=PropertyChanged, TargetNullValue=''}" Width="120"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                    </Expander>

                    <Expander Grid.Column="2" Header="ç®¡ç†å™¨ (Manager)" Style="{StaticResource SectionExpander}">
                        <Border Style="{StaticResource CardBorder}">
                            <StackPanel>
                                <CheckBox Content="å¯ç”¨ç®¡ç†å™¨" IsChecked="{Binding Configuration.Manager.EnableManager}" Margin="0,0,0,8" ToolTip="æ˜¯å¦å¯ç”¨ ComfyUI-Managerã€‚éœ€å·²å®‰è£… ComfyUI-Manager æ’ä»¶ã€‚"/>
                                <CheckBox Content="ç¦ç”¨ç®¡ç†å™¨ UI" IsChecked="{Binding Configuration.Manager.DisableManagerUi}" Margin="0,0,0,8" ToolTip="ç¦ç”¨ Manager çš„å‰ç«¯ UI æ˜¾ç¤ºã€‚"/>
                                <CheckBox Content="ä½¿ç”¨æ—§ç‰ˆ UI" IsChecked="{Binding Configuration.Manager.EnableLegacyUi}" ToolTip="å¼ºåˆ¶ä½¿ç”¨æ—§ç‰ˆ Manager UIã€‚"/>
                            </StackPanel>
                        </Border>
                    </Expander>
                </Grid>

                <!-- Launch -->
                <Expander Header="å¯åŠ¨é€‰é¡¹ (Launch)" Style="{StaticResource SectionExpander}">
                    <Border Style="{StaticResource CardBorder}">
                        <StackPanel>
                            <Grid Margin="0,0,0,10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0" Margin="0,0,10,0" ToolTip="æŒ‡å®šå‰ç«¯ç‰ˆæœ¬ã€‚(--front-end-version)">
                                    <TextBlock Text="å‰ç«¯ç‰ˆæœ¬" Style="{StaticResource FieldLabel}"/>
                                    <TextBox Text="{Binding Configuration.Launch.FrontEndVersion, UpdateSourceTrigger=PropertyChanged}"/>
                                </StackPanel>
                                <StackPanel Grid.Column="1" ToolTip="å‰ç«¯æ–‡ä»¶çš„æ ¹ç›®å½•è·¯å¾„ã€‚">
                                    <TextBlock Text="å‰ç«¯æ ¹ç›®å½•" Style="{StaticResource FieldLabel}"/>
                                    <TextBox Text="{Binding Configuration.Launch.FrontEndRoot, UpdateSourceTrigger=PropertyChanged}"/>
                                </StackPanel>
                            </Grid>
                            <StackPanel Orientation="Horizontal">
                                <CheckBox Content="è‡ªåŠ¨å¯åŠ¨æµè§ˆå™¨" IsChecked="{Binding Configuration.Launch.AutoLaunch}" Margin="0,0,20,0" ToolTip="å¯åŠ¨åŽè‡ªåŠ¨æ‰“å¼€é»˜è®¤æµè§ˆå™¨è®¿é—®ã€‚(--auto-launch)"/>
                                <CheckBox Content="ä¸æ‰“å°æœåŠ¡å™¨ä¿¡æ¯" IsChecked="{Binding Configuration.Launch.DontPrintServer}" ToolTip="å¯åŠ¨æ—¶ä¸æ‰“å°æœåŠ¡å™¨ä¿¡æ¯ã€‚(--dont-print-server)"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                </Expander>

                <!-- Miscellaneous -->
                <Expander Header="æ‚é¡¹ (Miscellaneous)" Style="{StaticResource SectionExpander}">
                    <Border Style="{StaticResource CardBorder}">
                        <StackPanel>
                            <WrapPanel Margin="0,0,0,10">
                                <CheckBox Content="Force Channels Last" IsChecked="{Binding Configuration.Miscellaneous.ForceChannelsLast}" Margin="0,0,20,8" ToolTip="å¼ºåˆ¶å°†å¼ é‡é€šé“æ”¾åœ¨æœ€åŽã€‚(--force-channels-last)"/>
                                <CheckBox Content="æ”¯æŒ FP8 è®¡ç®—" IsChecked="{Binding Configuration.Miscellaneous.SupportsFp8Compute}" Margin="0,0,20,8" ToolTip="å¯ç”¨ FP8 è®¡ç®—æ”¯æŒã€‚ä»…åœ¨éƒ¨åˆ†æ–°æ˜¾å¡ä¸Šæ”¯æŒã€‚"/>
                                <CheckBox Content="å¼ºåˆ¶éžé˜»å¡ž" IsChecked="{Binding Configuration.Miscellaneous.ForceNonBlocking}" Margin="0,0,20,8" ToolTip="å¼ºåˆ¶æ“ä½œéžé˜»å¡žã€‚(--force-non-blocking)"/>
                                <CheckBox Content="ç¡®å®šæ€§è®¡ç®—" IsChecked="{Binding Configuration.Miscellaneous.Deterministic}" Margin="0,0,20,8" ToolTip="ä½¿ç”¨ç¡®å®šæ€§ç®—æ³•ï¼Œä½¿ç»“æžœå¯é‡çŽ°ã€‚å¯èƒ½ä¼šé™ä½Žæ€§èƒ½ã€‚(--use-deterministic-algorithms)"/>
                                <CheckBox Content="ç¦ç”¨ Mmap" IsChecked="{Binding Configuration.Miscellaneous.DisableMmap}" Margin="0,0,20,8" ToolTip="ç¦ç”¨å†…å­˜æ˜ å°„æ–‡ä»¶åŠ è½½ã€‚(--disable-mmap)"/>
                                <CheckBox Content="Mmap Torch Files" IsChecked="{Binding Configuration.Miscellaneous.MmapTorchFiles}" Margin="0,0,20,8" ToolTip="å¯¹ Torch æ–‡ä»¶ä½¿ç”¨å†…å­˜æ˜ å°„ã€‚"/>
                                <CheckBox Content="ç¦ç”¨å…ƒæ•°æ®" IsChecked="{Binding Configuration.Miscellaneous.DisableMetadata}" Margin="0,0,20,8" ToolTip="ç”Ÿæˆçš„å›¾åƒä¸ä¿å­˜å…ƒæ•°æ®ï¼ˆå¦‚å·¥ä½œæµä¿¡æ¯ï¼‰ã€‚(--disable-metadata)"/>
                                <CheckBox Content="ç¦ç”¨æ‰€æœ‰è‡ªå®šä¹‰èŠ‚ç‚¹" IsChecked="{Binding Configuration.Miscellaneous.DisableAllCustomNodes}" Margin="0,0,20,8" ToolTip="ç¦ç”¨æ‰€æœ‰å·²å®‰è£…çš„è‡ªå®šä¹‰èŠ‚ç‚¹ã€‚(--disable-all-custom-nodes)"/>
                                <CheckBox Content="ç¦ç”¨ API èŠ‚ç‚¹" IsChecked="{Binding Configuration.Miscellaneous.DisableApiNodes}" Margin="0,0,20,8" ToolTip="ç¦ç”¨ API ç›¸å…³çš„èŠ‚ç‚¹ã€‚"/>
                                <CheckBox Content="å¤šç”¨æˆ·æ¨¡å¼" IsChecked="{Binding Configuration.Miscellaneous.MultiUser}" Margin="0,0,20,8" ToolTip="å¯ç”¨å¤šç”¨æˆ·æ”¯æŒã€‚(--multi-user)"/>
                                <CheckBox Content="æ—¥å¿—è¾“å‡ºåˆ° Stdout" IsChecked="{Binding Configuration.Miscellaneous.LogStdout}" Margin="0,0,20,8" ToolTip="å°†æ—¥å¿—è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºæµã€‚"/>
                                <CheckBox Content="åŽ‹ç¼©å“åº”ä½“" IsChecked="{Binding Configuration.Miscellaneous.EnableCompressResponseBody}" Margin="0,0,20,8" ToolTip="å¯ç”¨ HTTP å“åº”ä½“åŽ‹ç¼©ã€‚"/>
                                <CheckBox Content="ç¦ç”¨èµ„æºè‡ªåŠ¨æ‰«æ" IsChecked="{Binding Configuration.Miscellaneous.DisableAssetsAutoscan}" Margin="0,0,0,8" ToolTip="ç¦ç”¨å¯åŠ¨æ—¶çš„èµ„æºæ–‡ä»¶è‡ªåŠ¨æ‰«æã€‚"/>
                            </WrapPanel>

                            <WrapPanel Margin="0,0,0,10">
                                <StackPanel Margin="0,0,20,10" ToolTip="è®¾ç½®é»˜è®¤çš„å“ˆå¸Œå‡½æ•°ã€‚é»˜è®¤ä¸º sha256ã€‚">
                                    <TextBlock Text="é»˜è®¤å“ˆå¸Œå‡½æ•°" Style="{StaticResource FieldLabel}"/>
                                    <TextBox Text="{Binding Configuration.Miscellaneous.DefaultHashingFunction, UpdateSourceTrigger=PropertyChanged}" Width="180"/>
                                </StackPanel>
                                <StackPanel Margin="0,0,20,10" ToolTip="è®¾ç½®æ—¥å¿—è¯¦ç»†çº§åˆ«ã€‚é»˜è®¤ä¸º infoã€‚(--verbose, --quiet)">
                                    <TextBlock Text="æ—¥å¿—çº§åˆ«" Style="{StaticResource FieldLabel}"/>
                                    <ComboBox ItemsSource="{Binding LogLevels}" SelectedItem="{Binding Configuration.Miscellaneous.Verbose}" Width="150"/>
                                </StackPanel>
                                <StackPanel Margin="0,0,0,10" ToolTip="è®¾ç½® ComfyUI API çš„åŸºç¡€ URLã€‚">
                                    <TextBlock Text="Comfy API Base" Style="{StaticResource FieldLabel}"/>
                                    <TextBox Text="{Binding Configuration.Miscellaneous.ComfyApiBase, UpdateSourceTrigger=PropertyChanged}" Width="200"/>
                                </StackPanel>
                            </WrapPanel>

                            <StackPanel Margin="0,0,0,10" ToolTip="è®¾ç½®æ•°æ®åº“è¿žæŽ¥å­—ç¬¦ä¸²ã€‚">
                                <TextBlock Text="æ•°æ®åº“ URL" Style="{StaticResource FieldLabel}"/>
                                <TextBox Text="{Binding Configuration.Miscellaneous.DatabaseUrl, UpdateSourceTrigger=PropertyChanged}"/>
                            </StackPanel>

                            <StackPanel Margin="0,0,0,10" ToolTip="å¯ç”¨å¿«é€Ÿå¯åŠ¨é€‰é¡¹ã€‚æ¯è¡Œä¸€ä¸ªé€‰é¡¹ã€‚(--fast)">
                                <TextBlock Text="å¿«é€Ÿé€‰é¡¹ (Fast Options)" Style="{StaticResource FieldLabel}"/>
                                <TextBox Text="{Binding FastOptionsText, UpdateSourceTrigger=PropertyChanged}"
                                         AcceptsReturn="True" Height="60" TextWrapping="Wrap"/>
                            </StackPanel>

                            <StackPanel ToolTip="è‡ªå®šä¹‰èŠ‚ç‚¹ç™½åå•ã€‚åªæœ‰åœ¨åå•ä¸­çš„èŠ‚ç‚¹ä¼šè¢«åŠ è½½ã€‚æ¯è¡Œä¸€ä¸ªåç§°ã€‚">
                                <TextBlock Text="è‡ªå®šä¹‰èŠ‚ç‚¹ç™½åå•" Style="{StaticResource FieldLabel}"/>
                                <TextBox Text="{Binding WhitelistCustomNodesText, UpdateSourceTrigger=PropertyChanged}"
                                         AcceptsReturn="True" Height="60" TextWrapping="Wrap"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                </Expander>

                <!-- Command Preview Removed -->
            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl>
